# 服务发现配置
```shell script
    - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      job_name: sdp-exporter
      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - regex: (.*)
        replacement: ${1}:17000
        source_labels:
        - __meta_kubernetes_node_name
        target_label: __address__
      - replacement: /metrics
        target_label: __metrics_path__
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)
      scheme: http
      tls_config:
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        insecure_skip_verify: true
      scrape_interval: 1m
      scrape_timeout: 30s

    - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      job_name: sdp-exporter-slow
      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - regex: (.*)
        replacement: ${1}:17001
        source_labels:
        - __meta_kubernetes_node_address_InternalIP
        target_label: __address__
      - replacement: /metrics
        target_label: __metrics_path__
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)
      scheme: http
      tls_config:
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        insecure_skip_verify: true
      scrape_interval: 5m
      scrape_timeout: 5m
```


# 磁盘告警配置
```yaml
    groups:
    - name: disk-pressure
      rules:
      - alert: HighErrorRate
        expr:  max(sdp_disk_used_size{directory="data"}/sdp_disk_capacity_size{directory="data"}*100)by(node) >80
        for: 10m
        labels:
          AREA: CL
        annotations:
          summary: "{{ $labels.node }} 磁盘使用率：{{ $value }}"
          description:  "{{ $labels.node }} 磁盘使用率：{{ $value }}"
    - name: http-probe
      rules:
      - alert: HttpProbeError
        expr:  max(probe_http_status_code{} != 200 )by(instance,job)
        for: 10m
        labels:
          AREA: CL
        annotations:
          summary: "{{ $labels.instance }} 服务拨测异常：{{ $labels.job }}"
          description:  "{{ $labels.instance }} 服务拨测异常：{{ $labels.job }}"
```

# AlertManger配置

```yaml
    global:
      resolve_timeout: 5m
    route:
      receiver: 'sdp-alert'
      group_by: 
      - 'alertname'
      group_wait: 30m
      group_interval: 30m
      repeat_interval: 60m
    receivers:
    - name: 'sdp-alert'
      webhook_configs:
      - url: 'http://xxxxx/v1/alert/wx' 
```

# 参考
[AlertManger 配置参考](https://www.robustperception.io/whats-the-difference-between-group_interval-group_wait-and-repeat_interval)